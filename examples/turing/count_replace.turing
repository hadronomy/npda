# /// config
# num_tapes = 2
# tape_direction = "bidirectional"
# operation_mode = "simultaneous"
# allow_stay = true
# ///

# Q (states)
qI1 qI2 qI3 qIBack qS qIncAL qIncAR qIncBR qIncBL qRew1 qRew1L qPrepL qPrepL2 qCopyL qCopyR qFinish qFinish2 qAcc

# Σ (input alphabet)
a b

# Γ (tape alphabet)
a b 1 * _

# q0 (start state)
qI1

# b (blank symbol)
_

# F (accepting states)
qAcc

# Transiciones multi-cinta (N=2): from r1 r2 to w1 m1 w2 m2

# Inicialización de la cinta 2 como "1 * 1"
qI1 a _ qI2 a S 1 R
qI1 b _ qI2 b S 1 R
qI1 _ _ qI2 _ S 1 R

qI2 a _ qI3 a S * R
qI2 b _ qI3 b S * R
qI2 _ _ qI3 _ S * R

qI3 a _ qIBack a S 1 L
qI3 b _ qIBack b S 1 L
qI3 _ _ qIBack _ S 1 L

# Volver con la cabeza de la cinta 2 a '*'
qIBack a 1 qIBack a S 1 L
qIBack b 1 qIBack b S 1 L
qIBack _ 1 qIBack _ S 1 L
qIBack a * qS a S * S
qIBack b * qS b S * S
qIBack _ * qS _ S * S

# Escaneo de la entrada en cinta 1
qS a * qIncAL a S * L
qS b * qIncBR b S * R
qS _ * qRew1 _ S * S

# Rebobinar cinta 1 hasta el blanco izquierdo real de la entrada
qRew1 _ * qRew1L _ L * S
qRew1 a * qRew1L a L * S
qRew1 b * qRew1L b L * S
qRew1L a * qRew1L a L * S
qRew1L b * qRew1L b L * S
qRew1L _ * qPrepL _ R * S

# Incrementar conteo de 'a' (añadir '1' a la izquierda de '*')
qIncAL a 1 qIncAL a S 1 L
qIncAL a _ qIncAR a S 1 R
qIncAR a 1 qIncAR a S 1 R
qIncAR a * qS a R * S

# Incrementar conteo de 'b' (añadir '1' a la derecha de '*')
qIncBR b 1 qIncBR b S 1 R
qIncBR b _ qIncBL b S 1 L
qIncBL b 1 qIncBL b S 1 L
qIncBL b * qS b R * S

# Preparar: mover cabeza de cinta 2 al primer '1' del bloque izquierdo
qPrepL a * qPrepL2 a S * L
qPrepL b * qPrepL2 b S * L
qPrepL _ * qPrepL2 _ S * L

qPrepL2 a 1 qPrepL2 a S 1 L
qPrepL2 b 1 qPrepL2 b S 1 L
qPrepL2 _ 1 qPrepL2 _ S 1 L
qPrepL2 a _ qCopyL a S _ R
qPrepL2 b _ qCopyL b S _ R
qPrepL2 _ _ qCopyL _ S _ R

# Copiar bloque izquierdo de '1's a la cinta 1 (sobrescribe a/b/_/1 con 1)
qCopyL a 1 qCopyL 1 R 1 R
qCopyL b 1 qCopyL 1 R 1 R
qCopyL _ 1 qCopyL 1 R 1 R
qCopyL 1 1 qCopyL 1 R 1 R

# Al encontrar '*' en cinta 2, escribir '*' en cinta 1 (separador temporal) y pasar al bloque derecho
qCopyL a * qCopyR * R * R
qCopyL b * qCopyR * R * R
qCopyL _ * qCopyR * R * R
qCopyL 1 * qCopyR * R * R

# Copiar bloque derecho de '1's a la cinta 1 (sobrescribe a/b/_/1 con 1)
qCopyR a 1 qCopyR 1 R 1 R
qCopyR b 1 qCopyR 1 R 1 R
qCopyR _ 1 qCopyR 1 R 1 R
qCopyR 1 1 qCopyR 1 R 1 R

# Fin del bloque derecho (cinta 2 lee '_'): pasar a fase de rebobinado final
qCopyR a _ qFinish a L _ S
qCopyR b _ qFinish b L _ S
qCopyR _ _ qFinish _ L _ S
qCopyR 1 _ qFinish 1 L _ S

# Rebobinar: mover a la izquierda hasta convertir el separador '*' a '_' y seguir al blanco izquierdo
qFinish 1 _ qFinish 1 L _ S
qFinish * _ qFinish2 _ L _ S

# Tras convertir '*', seguir a la izquierda hasta el blanco izquierdo y dejar la cabeza en el primer '1'
qFinish2 1 _ qFinish2 1 L _ S
qFinish2 _ _ qAcc _ R _ S